# Слои архитктуры ios
![[architectureIos.png]](![[architectureIos.png]](https://github.com/badyi/SberLecturesVault/blob/master/SberLectures/Attachments/architectureIos.png))

Приложения не взаимодействуют напрямую с физическим оборудованием: iOS выступает в качестве посредника между аппаратным обеспечением устройства и приложениями, которые вы создаете. Приложения общаются с ним через специальные системные интерфейсы (API). Эти интерфейсы облегчают создание приложений, которые работают на устройствах, имеющих различные аппаратные возможности. Реализация технологий iOS может рассматриваться как набор слоев, которые изображены на рисунке. Нижние уровни содержат фундаментальные сервисы и технологии. Слои более высокого уровня строятся на слоях более нижних уровней и предоставляют более сложные услуги и технологии.

## Core OS
Слой Core OS предоставляет множество сред разработки, которое ваше приложение может использовать напрямую (например, среды Accelerate и Security). Слой Core OS инкапсулирует окружающую среду ядра, а также низкоуровневые UNIX-интерфейсы, к которым у вашего приложения нет доступа по очевидным причинам. Тем не менее, посредством основанной на С библиотеки libSystem, ко многим низкоуровневым свойствам можно осуществлять доступ напрямую (например, к сокетам BSD, потокам POSIX и DNS-сервисам).

## Core Services 
Уровень сервисов ядра(Core Service) - предоставляет доступ к таким сервисам как:

- Встроенная база данных( SQLite), позволяющая создавать модель данных, а также осуществлять SQL запросы

- Файловый диспетчер(File Accesses), сервис имеющий высокий уровень интерфейса для доступа к различным файлам принадлежащим приложению.

- Локация(Core Location) - сервис позволяющий отследить текущее местоположение устройства, а также отслеживать его длительные перемещения.

- Интернет сервис(Net Service) - сервис позволяющий получать и передавать данные через сеть интернет.

## Media
Уровень медиа - содержит инструменты позволяющие обрабатывать большинство форматов медиаданных, например:

- Аудио(Core Audio) - позволяет записывать, прослушивать , а также и редактировать различные аудио дорожки. Возможность достать из видео, определенную дорожку.

- Видео(Video playback) - сервис позволяющий воспроизводить, перематывать, останавливать видео. Редактирование видео подразумевает изменение расширения, длины или качества.

- Анимации(Core Animation) - библиотека позволяющая создавать анимации. При создании анимации может использоваться как показ картинок последовательно, так и изменение различных параметров элементов интерфейса, таких как высота, ширина, местоположение, видимость и т.д.

## Cocoa Touch 
Уровень интерфейса - имеет множество элементов для создания мобильных интерфейсов, а а также предоставляет остальным слоям информацию входящую от пользователя. В него входят такие элементы как:

- Обработчик множественных нажатий(Multi-Touch) - позволяющий обрабатывать несколько нажатий на экран.
 
- Обработчик жестов(Core Motion) - позволяющий обработать различные жесты производящиеся на экране устройства, такие как сдвиг вправо, вниз и т.д.

- Галерея(ImagePickers) - предоставляет доступ к фотографиям и видео лежащих на устройстве. С помощью него приложения могут получить доступ и загрузить к себе файлы из галереи.

- Камера(Camera) - используется для снимком и последующим загрузкой данных в приложение.

# Цикл жизни приложения
![[lifeCycleIos.png]]

В любой момент приложение находится в каком либо из перечисленных ниже состояний. Система меняет состояния вашего приложения в ответ на происходящие события. Например, когда пользователь нажимает кнопку Home, или поступает входящий вызов, или что либо еще — приложения в ответ на все это меняют свое состояние.

- Not Running - Приложение не запущено, либо запущенно но прервано системой.

- Inactive - Приложение работает, но в настоящий момент ничего не делает (это может быть связано с выполнением другого кода). Приложение, как правило, остается в этом состоянии очень мало времени и переходит в другое состояние
- Active - Нормальный обычный режим работы приложения на переднем плане.
- Background - Приложение находится в фоне, но работает. Большинство приложений входят в это состояние на короткое время и позже приостанавливаются.
- Suspended - Приложение работает в фоне, но не выполняет никакой код. Система перемещает приложение в это состояние автоматически и не предупреждает об этом.

### Цикл жизни приложения. Табличное представление
![[lifeCycleTableIos.png]]

## Life cylce in code

![[objcMain.png]]

Во время запуска функция UIApplicationMain устанавливает несколько ключевых объектов и запускает приложение. В основе каждого приложения iOS лежит объект UIApplication, задача которого - облегчить взаимодействие между системой и другими объектами в приложении.

Основной цикл выполнения приложения обрабатывает все события связанные с пользователем. Объект UIApplication создает во время запуска основной цикл выполнения и использует его для обработки событий и обработки обновлений интерфейса на основе представлений. Как следует из названия, основной цикл выполнения выполняется в главном потоке приложения. Такое поведение гарантирует, что связанные с пользователем события обрабатываются последовательно в том порядке, в котором они были получены.

Четвертый аргумент указывает, какой класс должен быть классом-делегатом UIApplication, который будет отвечать на все, что указано в протоколе UIApplicationDelegate

### in Swift
Атрибут @main в Swift заменяет файл main.m из проектов на Objective-C (цель которого \- реализовать main-функцию, точку входа в приложение для всех программ C, и вызвать UIApplicationMain, чтобы запустить цикл выполнения Cocoa Touch и инфраструктуру приложения).

В Objective-C мы указывали класс, который должен был выступать в качестве делегата общего объекта UIApplication. В Swift вы можете легко обозначить этот класс, добавив атрибут @main к объявлению этого класса.

И мы все еще можем создать руками класс maim.swift. Скорее всего нам это никогда не понадобиться

##  Основной цикл приожения
Объект UIApplication управляет циклом событий (event loop) и другим поведением высокоуровневого приложения. Он также сообщает о ключевых переходах приложений и некоторых специальных событиях (например, о входящих push-уведомлениях) своему делегату, который является настраиваемым объектом, который вы определяете. Используйте объект UIApplication как есть, то есть без создания подклассов.

Делегат приложения (Application Delegate) - это сердце вашего пользовательского кода. Этот объект работает в тандеме с объектом UIApplication для обработки инициализации приложения, переходов между состояниями и многих высокоуровневых событий приложения. Этот объект также является единственным, который гарантированно присутствует в каждом приложении, поэтому он часто используется для настройки исходных структур данных приложения.

![[mainRunLoop.png]]

 

Main run loop (основной цикл выполнения) приложения обрабатывает все события, связанные с пользователем. Объект UIApplication устанавливает main run loop во время запуска и использует его для обработки событий и обработки обновлений интерфейсов на основе представлений. Как следует из названия, основной цикл выполнения выполняется в основном потоке приложения. Такое поведение гарантирует, что связанные с пользователем события обрабатываются последовательно в том порядке, в котором они были получены.

Run loop, по сути, делает две вещи:  
• ожидает пока что\-то не произойдёт. • отправляет сообщение к получателю.

События помещаются в очередь внутри приложения и отправляются одно за другим в основной run loop для выполнения. Объект UIApplication \- это первый объект, который получает событие и принимает решение о том, что нужно сделать. Событие касания обычно отправляется объекту главного окна, который, в свою очередь, отправляет его в представление, в котором произошло касание.

Run loop - абстракция, предоставляющая механизм для работы с входным набором данных \- сокетов, данных с портов, клавы и тд
